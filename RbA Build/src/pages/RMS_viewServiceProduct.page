<apex:page standardController="Product2" extensions="RMS_serviceWarrantyManager">
    <apex:includeScript value="/support/console/28.0/integration.js"/>
    <apex:includeScript value="{!$Resource.jquery}" />
    
        <script type="text/javascript">
        var theURL;
        var tabName;
        var primaryTabId;
        
        
        //The callback function that openSubtab will call once it's got the ID for its primary tab
        var callOpenSubtab = function callOpenSubtab(result) {
            sforce.console.openSubtab(result.id, 
               theURL, true, tabName);
            theURL = '';
            tabName= '';
        };
        function openSubtab(urlPart, theTabName) {
            if(sforce.console.isInConsole()){
                theURL = urlPart;
                tabName = theTabName;
                sforce.console.getEnclosingPrimaryTabId(callOpenSubtab);
            }else{
                top.location.href = '/'+urlPart;
            }
        }
        
        
        var callOpenConsoleUrl = function callOpenConsoleUrl(result) {
            sforce.console.openConsoleUrl(result.id, 
            result.consoleUrl, 
            true 
           // (optional)tabLabels:String, 
           // (optional)tabNames:String, 
           // (optional)callback:Function
            );
            
        };
       
        function displayResult(result) {
             if (result.success) {
                 alert('Tab status has been successfully updated');
             } else {
                 alert('Tab status couldnâ€™t be updated');
             }
        }
        
        function callGenerateConsoleURL(urlPart, theTabName) {
            if(sforce.console.isInConsole()) {
                tabName = theTabName;
                var productURL = '/'+'{!Product2.Id}';
                sforce.console.generateConsoleUrl([productURL, urlPart], callOpenConsoleUrl); 
            }else{
                top.location.href = '{!baseUrl}'+urlPart;
            
            }       
        }
        
        
    </script>
    <apex:detail relatedList="true" relatedListHover="true" inlineEdit="true"/>
    
    <apex:pageBlock title="Related Products" rendered="{!IF(Product2.RecordType.Name == 'Master Product' || Product2.RecordType.Name == 'Service Product',true,false)}">
        <apex:form style="text-align:center; margin-bottom: 5px;">
        	<apex:commandButton action="{!addServiceProduct}" value="Add Service Product" id="addSProduct" rendered="{!IF(Product2.RecordType.Name == 'Master Product',true,false)}" style="margin-left:2%"/>
        	<apex:commandButton action="{!addMasterProduct}" value="Add Master Product" id="addMProduct" rendered="{!IF(Product2.RecordType.Name == 'Service Product',true,false)}" style="margin-left:2%"/>                        
        </apex:form>
        <apex:pageBlockTable title="Service Products" value="{!Product2.Service_Products1__r}" var="item" style="width:100%"  rendered="{!IF(Product2.RecordType.Name == 'Master Product',true,false)}" >
            <apex:column headerValue="Action" width="65px;">
				<apex:outputLink value="{!URLFOR($Action.Service_Product__c.Delete, item.id)}" onclick="return window.confirm('Are you sure?');">Remove</apex:outputLink> 
            </apex:column>
            <apex:column headerValue="Service Product">
                <apex:outputField value="{!item.Service_Product__c}"/>                
            </apex:column>
        </apex:pageBlockTable>	
                <apex:pageBlockTable title="Master Products" value="{!Product2.Service_Products__r}" var="item" style="width:100%" rendered="{!IF(Product2.RecordType.Name == 'Service Product',true,false)}" >
            <apex:column headerValue="Action" width="65px;">
				<apex:outputLink value="{!URLFOR($Action.Service_Product__c.Delete, item.id)}" onclick="return window.confirm('Are you sure?');">Remove</apex:outputLink> 
            </apex:column>
            <apex:column headerValue="Master Product">
                <apex:outputField value="{!item.Master_Product__c}"/>
            </apex:column>
        </apex:pageBlockTable>
    </apex:pageBlock> 
    
        <apex:pageBlock title="Procedure Codes" rendered="{!IF(Product2.RecordType.Name == 'Service Product',true,false)}" >
        <apex:form style="text-align:center; margin-bottom: 5px;">            
            <apex:commandButton action="{!addProcedureCode}" value="Assign Procedure Code" id="addPC" style="margin-left:2%"/>            
        </apex:form>
        <apex:pageBlockTable title="Procedure Codes" value="{!Product2.Product_Procedure_Codes1__r}" var="item" style="width:100%">
            <apex:column headerValue="Action" width="65px;">
                <apex:outputLink value="{!URLFOR($Action.Procedure_Code_Assignment__c.Delete, item.id)}" onclick="return window.confirm('Are you sure?');">Remove</apex:outputLink> 
            </apex:column>
            <apex:column headerValue="Procedure Code">
                <apex:outputField value="{!item.Procedure_Code__c}"/>                
            </apex:column>
            <apex:column headerValue="Description">
                <apex:outputField value="{!item.Description__c}"/>
            </apex:column>
            <apex:column headerValue="Time (Minutes/Each)">
                <apex:outputField value="{!item.Procedure_Code__r.Time_Minutes_Each__c}"/>
            </apex:column>
        </apex:pageBlockTable>	                
    </apex:pageBlock> 
    
    
</apex:page>