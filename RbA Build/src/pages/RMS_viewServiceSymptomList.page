<apex:page standardController="Service_Symptom_List__c" extensions="RMS_viewSSLCtrlr">
    <apex:includeScript value="/support/console/28.0/integration.js"/>
    <apex:includeScript value="{!$Resource.jquery}" />
    
    <script type="text/javascript">
    var theURL;
    var tabName;
    var primaryTabId;
    
    
    //The callback function that openSubtab will call once it's got the ID for its primary tab
    var callOpenSubtab = function callOpenSubtab(result) {
        sforce.console.openSubtab(result.id, 
                                  theURL, true, tabName);
        theURL = '';
        tabName= '';
    };
    function openSubtab(urlPart, theTabName) {
        if(sforce.console.isInConsole()){
            theURL = urlPart;
            tabName = theTabName;
            sforce.console.getEnclosingPrimaryTabId(callOpenSubtab);
        }else{
            top.location.href = '/'+urlPart;
        }
    }
    
    
    var callOpenConsoleUrl = function callOpenConsoleUrl(result) {
        sforce.console.openConsoleUrl(result.id, 
                                      result.consoleUrl, 
                                      true 
                                      // (optional)tabLabels:String, 
                                      // (optional)tabNames:String, 
                                      // (optional)callback:Function
                                     );
        
    };
    
    function displayResult(result) {
        if (result.success) {
            alert('Tab status has been successfully updated');
        } else {
            alert('Tab status couldnâ€™t be updated');
        }
    }
    
    function callGenerateConsoleURL(urlPart, theTabName) {
        if(sforce.console.isInConsole()) {
            tabName = theTabName;
            var symptomURL = '/'+'{!Service_Symptom_List__c.Id}';
            sforce.console.generateConsoleUrl([symptomURL, urlPart], callOpenConsoleUrl); 
        }else{
            top.location.href = '{!baseUrl}'+urlPart;
            
        }       
    }
    
    
    </script>
    <apex:detail relatedList="true" relatedListHover="true" inlineEdit="true"/>
    
    <apex:pageBlock title="Problem Components">
        <apex:form style="text-align:center; margin-bottom: 5px;"> 
            <apex:commandButton action="{!addProblemComponent}" value="Assign Problem Component" id="addSProduct" style="margin-left:2%"/>
        </apex:form>
        <apex:pageBlockTable title="Problem Components" value="{!Service_Symptom_List__c.Problem_Component_Config__r}" var="item" style="width:100%" id="problemComponents">
            <apex:column headerValue="Action" width="65px;">
                <apex:outputLink value="{!URLFOR($Action.Problem_Component_Config__c.Delete, item.id)}" onclick="return window.confirm('Are you sure?');">Remove</apex:outputLink> 
            </apex:column>
            <apex:column headerValue="Problem Component">
                <apex:outputField value="{!item.Problem_Component__c}"/>                
            </apex:column>
        </apex:pageBlockTable>	                
    </apex:pageBlock> 
    
    <apex:pageBlock title="Procedure Codes">
        <apex:form style="text-align:center; margin-bottom: 5px;">            
            <apex:commandButton action="{!addProcedureCode}" value="Assign Procedure Code" style="margin-left:2%"/>
        </apex:form>
        <apex:pageBlockTable title="Procedure Codes" value="{!Service_Symptom_List__c.Procedure_Code_Assignments__r}" var="item" style="width:100%">
            <apex:column headerValue="Action" width="65px;">
                <apex:outputLink value="{!URLFOR($Action.Service_Symptom_Assignment__c.Delete, item.id)}" onclick="return window.confirm('Are you sure?');">Remove</apex:outputLink> 
            </apex:column>
            <apex:column headerValue="Procedure Code">
                <apex:outputField value="{!item.Procedure_Code__c}"/>                
            </apex:column>
            <apex:column headerValue="Description">
                <apex:outputField value="{!item.Procedure_Code__r.Description__c}"/>                
            </apex:column>
            <apex:column headerValue="Description">
                <apex:outputField value="{!item.Procedure_Code__r.Time_Minutes_Each__c}"/>                
            </apex:column>
        </apex:pageBlockTable>	                
    </apex:pageBlock>
    
    <apex:pageBlock title="Service Requests">
        <apex:pageBlockTable title="Service Requests" value="{!Service_Symptom_List__c.Service_Symptoms__r}" var="item" style="width:100%">
            <apex:column headerValue="Service Request Number">
                <apex:outputField value="{!item.Service_Product__r.OrderId}" label="Request Number"/>                
            </apex:column>
            <apex:column headerValue="Service Product Line Item">
                <apex:outputField value="{!item.Service_Product__c}"/>                
            </apex:column>            
            <apex:column headerValue="Service Product">
                <apex:outputField value="{!item.Service_Product__r.PricebookEntry.Product2Id}"/>                
            </apex:column>
            <apex:column headerValue="Quantity Ordered">
                <apex:outputField value="{!item.Service_Product__r.Quanity_Ordered__c}"/>                
            </apex:column>             
            <apex:column headerValue="Billable Amount">
                <apex:outputField value="{!item.Service_Product__r.Billable_Amount__c}"/>                
            </apex:column>            
            <apex:column headerValue="Installed Product">
                <apex:outputField value="{!item.Service_Product__r.Installed_Product_Asset__c}"/>                
            </apex:column>            
            <apex:column headerValue="Account">
                <apex:outputField value="{!item.Service_Product__r.Order.AccountId}"/>                
            </apex:column>             
            <apex:column headerValue="Sold Order">
                <apex:outputField value="{!item.Service_Product__r.Order.Sold_Order__c}"/>                
            </apex:column>  
            
        </apex:pageBlockTable>	                
    </apex:pageBlock>
    
    
</apex:page>