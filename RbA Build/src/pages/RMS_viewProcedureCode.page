<apex:page standardController="Procedure_Code__c" extensions="RMS_viewPCCtrlr">
    <apex:includeScript value="/support/console/28.0/integration.js"/>
    <apex:includeScript value="{!$Resource.jquery}" />
    
    <script type="text/javascript">
    var theURL;
    var tabName;
    var primaryTabId;
    
    
    //The callback function that openSubtab will call once it's got the ID for its primary tab
    var callOpenSubtab = function callOpenSubtab(result) {
        sforce.console.openSubtab(result.id, 
                                  theURL, true, tabName);
        theURL = '';
        tabName= '';
    };
    function openSubtab(urlPart, theTabName) {
        if(sforce.console.isInConsole()){
            theURL = urlPart;
            tabName = theTabName;
            sforce.console.getEnclosingPrimaryTabId(callOpenSubtab);
        }else{
            top.location.href = '/'+urlPart;
        }
    }
    
    
    var callOpenConsoleUrl = function callOpenConsoleUrl(result) {
        sforce.console.openConsoleUrl(result.id, 
                                      result.consoleUrl, 
                                      true 
                                      // (optional)tabLabels:String, 
                                      // (optional)tabNames:String, 
                                      // (optional)callback:Function
                                     );
        
    };
    
    function displayResult(result) {
        if (result.success) {
            alert('Tab status has been successfully updated');
        } else {
            alert('Tab status couldnâ€™t be updated');
        }
    }
    
    function callGenerateConsoleURL(urlPart, theTabName) {
        if(sforce.console.isInConsole()) {
            tabName = theTabName;
            var procedureURL = '/'+'{!Procedure_Code__c.Id}';
            sforce.console.generateConsoleUrl([procedureURL, urlPart], callOpenConsoleUrl); 
        }else{
            top.location.href = '{!baseUrl}'+urlPart;
            
        }       
    }
    
    
    </script>
    <apex:detail relatedList="true" relatedListHover="true" inlineEdit="true"/>
    
    <apex:pageBlock title="Service Products">
        <apex:form style="text-align:center; margin-bottom: 5px;">            
            <apex:commandButton action="{!addServiceProduct}" value="Assign Service Products" style="margin-left:2%"/>
        </apex:form>
        <apex:pageBlockTable title="Service Products" value="{!Procedure_Code__c.Product_Procedure_Codes1__r}" var="item" style="width:100%">
            <apex:column headerValue="Action" width="65px;">
                <apex:outputLink value="{!URLFOR($Action.Procedure_Code_Assignment__c.Delete, item.id)}" onclick="return window.confirm('Are you sure?');">Remove</apex:outputLink> 
            </apex:column>
            <apex:column headerValue="Service Product">
                <apex:outputField value="{!item.Service_Product__c}"/>                
            </apex:column>
        </apex:pageBlockTable>	                
    </apex:pageBlock> 
    
    <apex:pageBlock title="Service Symptoms">
        <apex:form style="text-align:center; margin-bottom: 5px;">            
            <apex:commandButton action="{!addServiceSymptom}" id="addSProduct" value="Assign Service Symptom" style="margin-left:2%"/>
        </apex:form>
        <apex:pageBlockTable title="Service Symptoms" value="{!Procedure_Code__c.Procedure_Code_Assignments__r}" var="item" style="width:100%">
            <apex:column headerValue="Action" width="65px;">
                <apex:outputLink value="{!URLFOR($Action.Service_Symptom_Assignment__c.Delete, item.id)}" onclick="return window.confirm('Are you sure?');">Remove</apex:outputLink> 
            </apex:column>
            <apex:column headerValue="Service Symptom">
                <apex:outputField value="{!item.Service_Symptom__c}"/>                
            </apex:column>
        </apex:pageBlockTable>	                
    </apex:pageBlock> 
    
    
</apex:page>